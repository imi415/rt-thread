#include <rtthread.h>

#include "fsl_clock.h"
#include "fsl_inputmux.h"
#include "fsl_reset.h"

#define APP_CAMERA_FW_BASE ((void *)0x04000000)
#define APP_CAMERA_STACK_SIZE (64)
#define APP_CAMERA_RES_HOR (160U)
#define APP_CAMERA_RES_VER (120U)
#define APP_CAMERA_FRAME_SIZE (APP_CAMERA_RES_HOR * APP_CAMERA_RES_VER * 2)
#define APP_CAMERA_I2C_BUS "i2c7"
#define APP_CAMERA_I2C_ADDR 0x21

typedef enum {
    APP_CAMERA_320240_FULL,
    APP_CAMERA_320240_DIV16,
    APP_CAMERA_480320_FULL,
    APP_CAMERA_320240_GS_DIV4,
    APP_CAMERA_320240_GS_DIV16,
    APP_CAMERA_384384_DIV16,
    APP_CAMERA_320480_FULL,
} app_camera_function_t;

typedef struct {
    uint32_t *stack;
    uint32_t *data;
} app_camera_params_t;

typedef struct {
    uint8_t address;
    uint8_t data;
} app_camera_init_reg_t;

static const uint8_t s_camera_if_firmware[] = {
    0x21U, 0x00U, 0x00U, 0x04U, 0x01U, 0x01U, 0x00U, 0x04U, 0x01U, 0x03U, 0x00U, 0x04U, 0xE1U, 0x03U, 0x00U, 0x04U,
    0x21U, 0x05U, 0x00U, 0x04U, 0x21U, 0x07U, 0x00U, 0x04U, 0x21U, 0x09U, 0x00U, 0x04U, 0x00U, 0x00U, 0x00U, 0x00U,
    0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U,
    0x04U, 0x18U, 0x04U, 0x33U, 0x10U, 0x18U, 0x68U, 0x02U, 0x10U, 0x18U, 0x60U, 0x02U, 0x01U, 0xB0U, 0x05U, 0x00U,
    0x01U, 0x8CU, 0x05U, 0x01U, 0x01U, 0x68U, 0x07U, 0x01U, 0x01U, 0x6CU, 0x07U, 0x01U, 0x06U, 0x74U, 0x47U, 0x00U,
    0x00U, 0x88U, 0x00U, 0x00U, 0x01U, 0x92U, 0x6CU, 0xDBU, 0x18U, 0x64U, 0x02U, 0x20U, 0x18U, 0x64U, 0x02U, 0x21U,
    0x18U, 0x64U, 0x02U, 0x22U, 0x18U, 0x64U, 0x02U, 0x23U, 0x18U, 0x64U, 0x02U, 0x24U, 0x18U, 0x64U, 0x02U, 0x25U,
    0x18U, 0x64U, 0x02U, 0x26U, 0x18U, 0x64U, 0x02U, 0x27U, 0x18U, 0x64U, 0x02U, 0xD2U, 0x00U, 0x04U, 0xF4U, 0x0FU,
    0x1CU, 0x36U, 0xD0U, 0x04U, 0x18U, 0x20U, 0x02U, 0xF2U, 0x18U, 0xECU, 0x02U, 0xC2U, 0xB3U, 0x00U, 0x00U, 0x04U,
    0xCFU, 0x00U, 0x00U, 0x04U, 0x18U, 0x20U, 0x02U, 0xF2U, 0x10U, 0x40U, 0xE8U, 0x20U, 0x02U, 0xC4U, 0x08U, 0x01U,
    0x08U, 0x76U, 0x87U, 0x02U, 0x18U, 0x20U, 0x02U, 0xF2U, 0x12U, 0x00U, 0x00U, 0x00U, 0x83U, 0x00U, 0x00U, 0x04U,
    0x18U, 0xECU, 0x02U, 0xC0U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U, 0x01U, 0x8CU, 0x05U, 0x01U,
    0x18U, 0x20U, 0x02U, 0xF2U, 0x14U, 0x11U, 0x00U, 0x00U, 0x83U, 0x00U, 0x00U, 0x04U, 0x18U, 0xCCU, 0x00U, 0x20U,
    0x18U, 0xCCU, 0x00U, 0x21U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U, 0x18U, 0x20U, 0x02U, 0xF2U,
    0x83U, 0x00U, 0x00U, 0x04U, 0x70U, 0x47U, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U,
    0x04U, 0x18U, 0x04U, 0x33U, 0x10U, 0x18U, 0x68U, 0x02U, 0x10U, 0x18U, 0x60U, 0x02U, 0x01U, 0xB0U, 0x05U, 0x00U,
    0x01U, 0x8CU, 0x05U, 0x03U, 0x01U, 0x68U, 0x07U, 0x01U, 0x01U, 0x6CU, 0x07U, 0x01U, 0x06U, 0x74U, 0x47U, 0x00U,
    0x00U, 0x88U, 0x00U, 0x00U, 0x01U, 0x92U, 0x6CU, 0xDBU, 0x18U, 0x64U, 0x02U, 0x20U, 0x18U, 0x64U, 0x02U, 0x21U,
    0x18U, 0x64U, 0x02U, 0x22U, 0x18U, 0x64U, 0x02U, 0x23U, 0x18U, 0x64U, 0x02U, 0x24U, 0x18U, 0x64U, 0x02U, 0x25U,
    0x18U, 0x64U, 0x02U, 0x26U, 0x18U, 0x64U, 0x02U, 0x27U, 0x18U, 0x64U, 0x02U, 0xD2U, 0x00U, 0x08U, 0x14U, 0x00U,
    0x00U, 0x14U, 0x04U, 0x00U, 0x1CU, 0x36U, 0xD0U, 0x04U, 0x0DU, 0x80U, 0xF7U, 0x0FU, 0x18U, 0xECU, 0x02U, 0xC2U,
    0x87U, 0x01U, 0x00U, 0x04U, 0xA7U, 0x01U, 0x00U, 0x04U, 0x08U, 0x76U, 0xC7U, 0x01U, 0x02U, 0xC4U, 0x08U, 0x01U,
    0x18U, 0x20U, 0x02U, 0xF2U, 0x18U, 0xECU, 0x02U, 0xC0U, 0x00U, 0x08U, 0x14U, 0x00U, 0x00U, 0x14U, 0x04U, 0x00U,
    0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U, 0x01U, 0x8CU, 0x05U, 0x03U, 0x18U, 0x20U, 0x02U, 0xF2U,
    0x67U, 0x01U, 0x00U, 0x04U, 0x18U, 0xCCU, 0x00U, 0x20U, 0x18U, 0xCCU, 0x00U, 0x21U, 0x00U, 0x14U, 0x04U, 0x00U,
    0x0DU, 0x88U, 0xF4U, 0x1FU, 0x01U, 0x90U, 0x05U, 0x02U, 0x0EU, 0x82U, 0xF4U, 0x00U, 0x20U, 0x04U, 0x04U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0xE4U, 0x01U, 0x20U, 0x04U, 0x14U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0xD4U, 0x02U,
    0x20U, 0x04U, 0x24U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0xC4U, 0x03U,
    0x20U, 0x04U, 0x34U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0xB4U, 0x04U, 0x20U, 0x04U, 0x44U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0xA4U, 0x05U, 0x20U, 0x04U, 0x54U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x94U, 0x06U, 0x20U, 0x04U, 0x64U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x84U, 0x07U, 0x20U, 0x04U, 0x74U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x74U, 0x08U, 0x20U, 0x04U, 0x84U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x64U, 0x09U, 0x20U, 0x04U, 0x94U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x54U, 0x0AU,
    0x20U, 0x04U, 0xA4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x44U, 0x0BU,
    0x20U, 0x04U, 0xB4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x34U, 0x0CU, 0x20U, 0x04U, 0xC4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x24U, 0x0DU, 0x20U, 0x04U, 0xD4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x14U, 0x0EU, 0x20U, 0x04U, 0xE4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U, 0x0EU, 0x82U, 0x04U, 0x0FU,
    0x20U, 0x04U, 0xF4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x38U, 0xECU, 0x02U, 0x21U, 0x38U, 0xECU, 0x02U, 0x22U, 0x06U, 0x88U, 0x14U, 0x00U, 0x18U, 0x20U, 0x02U, 0xF2U,
    0x67U, 0x01U, 0x00U, 0x04U, 0x70U, 0x47U, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U,
    0x04U, 0x18U, 0x04U, 0x33U, 0x10U, 0x18U, 0x68U, 0x02U, 0x10U, 0x18U, 0x60U, 0x02U, 0x01U, 0xB0U, 0x05U, 0x00U,
    0x01U, 0x8CU, 0x05U, 0x01U, 0x01U, 0x68U, 0x07U, 0x01U, 0x01U, 0x6CU, 0x07U, 0x01U, 0x06U, 0x74U, 0x47U, 0x00U,
    0x00U, 0x88U, 0x00U, 0x00U, 0x01U, 0x92U, 0x6CU, 0xDBU, 0x18U, 0x64U, 0x02U, 0x20U, 0x18U, 0x64U, 0x02U, 0x21U,
    0x18U, 0x64U, 0x02U, 0x22U, 0x18U, 0x64U, 0x02U, 0x23U, 0x18U, 0x64U, 0x02U, 0x24U, 0x18U, 0x64U, 0x02U, 0x25U,
    0x18U, 0x64U, 0x02U, 0x26U, 0x18U, 0x64U, 0x02U, 0x27U, 0x18U, 0x64U, 0x02U, 0xD2U, 0x00U, 0x04U, 0xF4U, 0x0FU,
    0x1CU, 0x36U, 0xD0U, 0x04U, 0x10U, 0x40U, 0xE8U, 0x20U, 0x18U, 0xECU, 0x02U, 0xC2U, 0x8BU, 0x03U, 0x00U, 0x04U,
    0xABU, 0x03U, 0x00U, 0x04U, 0x08U, 0xBEU, 0x04U, 0x3CU, 0x82U, 0xC4U, 0x08U, 0x01U, 0x08U, 0x76U, 0x47U, 0x02U,
    0x98U, 0x20U, 0x02U, 0xF2U, 0x06U, 0x88U, 0x14U, 0x00U, 0x18U, 0xECU, 0x02U, 0xC0U, 0x18U, 0xECU, 0x02U, 0xC1U,
    0x01U, 0x8CU, 0x05U, 0x01U, 0x00U, 0x08U, 0x04U, 0x00U, 0x00U, 0x10U, 0x04U, 0x00U, 0x18U, 0x20U, 0x02U, 0xF2U,
    0x05U, 0x44U, 0x00U, 0x33U, 0x63U, 0x03U, 0x00U, 0x04U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x06U, 0x10U, 0x15U, 0x00U,
    0x08U, 0x3EU, 0x05U, 0x05U, 0xB8U, 0xECU, 0x02U, 0xC2U, 0x08U, 0x3EU, 0x05U, 0x19U, 0xB8U, 0xECU, 0x02U, 0x22U,
    0x00U, 0x08U, 0x04U, 0x00U, 0x63U, 0x03U, 0x00U, 0x04U, 0x70U, 0x47U, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U,
    0x04U, 0x18U, 0x04U, 0x33U, 0x10U, 0x18U, 0x68U, 0x02U, 0x10U, 0x18U, 0x60U, 0x02U, 0x01U, 0xB0U, 0x05U, 0x00U,
    0x01U, 0x8CU, 0x05U, 0x03U, 0x01U, 0x68U, 0x07U, 0x01U, 0x01U, 0x6CU, 0x07U, 0x01U, 0x06U, 0x74U, 0x47U, 0x00U,
    0x00U, 0x88U, 0x00U, 0x00U, 0x01U, 0x92U, 0x6CU, 0xDBU, 0x18U, 0x64U, 0x02U, 0x20U, 0x18U, 0x64U, 0x02U, 0x21U,
    0x18U, 0x64U, 0x02U, 0x22U, 0x18U, 0x64U, 0x02U, 0x23U, 0x18U, 0x64U, 0x02U, 0x24U, 0x18U, 0x64U, 0x02U, 0x25U,
    0x18U, 0x64U, 0x02U, 0x26U, 0x18U, 0x64U, 0x02U, 0x27U, 0x18U, 0x64U, 0x02U, 0xD2U, 0x00U, 0x14U, 0xF4U, 0x0FU,
    0x1CU, 0x36U, 0xD0U, 0x04U, 0x10U, 0x40U, 0xE9U, 0x20U, 0x18U, 0xECU, 0x02U, 0xC2U, 0x73U, 0x04U, 0x00U, 0x04U,
    0x8FU, 0x04U, 0x00U, 0x04U, 0x1CU, 0x36U, 0xD0U, 0x04U, 0x10U, 0x40U, 0xE9U, 0x20U, 0x18U, 0xECU, 0x02U, 0xC2U,
    0x73U, 0x04U, 0x00U, 0x04U, 0x8FU, 0x04U, 0x00U, 0x04U, 0x02U, 0xC4U, 0x08U, 0x01U, 0x43U, 0x04U, 0x00U, 0x04U,
    0x18U, 0xECU, 0x02U, 0xC0U, 0x00U, 0x08U, 0x14U, 0x00U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U,
    0x01U, 0x8CU, 0x05U, 0x03U, 0x18U, 0x20U, 0x02U, 0xF2U, 0x43U, 0x04U, 0x00U, 0x04U, 0x18U, 0xCCU, 0x00U, 0x20U,
    0x18U, 0xCCU, 0x00U, 0x21U, 0x0DU, 0x88U, 0xF4U, 0x1FU, 0x01U, 0x90U, 0x05U, 0x02U, 0x0EU, 0x82U, 0xC4U, 0x03U,
    0x20U, 0x04U, 0x04U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x84U, 0x07U,
    0x20U, 0x04U, 0x14U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x44U, 0x0BU, 0x20U, 0x04U, 0x24U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U, 0x0EU, 0x82U, 0x04U, 0x0FU, 0x20U, 0x04U, 0x34U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x38U, 0xECU, 0x02U, 0x21U,
    0x38U, 0xECU, 0x02U, 0x22U, 0x06U, 0x88U, 0x14U, 0x00U, 0x18U, 0x20U, 0x02U, 0xF2U, 0x43U, 0x04U, 0x00U, 0x04U,
    0x70U, 0x47U, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U,
    0x04U, 0x18U, 0x04U, 0x33U, 0x10U, 0x18U, 0x68U, 0x02U, 0x10U, 0x18U, 0x60U, 0x02U, 0x01U, 0xB0U, 0x05U, 0x00U,
    0x01U, 0x8CU, 0x05U, 0x03U, 0x01U, 0x68U, 0x07U, 0x01U, 0x01U, 0x6CU, 0x07U, 0x01U, 0x06U, 0x74U, 0x47U, 0x00U,
    0x00U, 0x88U, 0x00U, 0x00U, 0x01U, 0x92U, 0x6CU, 0xDBU, 0x18U, 0x64U, 0x02U, 0x20U, 0x18U, 0x64U, 0x02U, 0x21U,
    0x18U, 0x64U, 0x02U, 0x22U, 0x18U, 0x64U, 0x02U, 0x23U, 0x18U, 0x64U, 0x02U, 0x24U, 0x18U, 0x64U, 0x02U, 0x25U,
    0x18U, 0x64U, 0x02U, 0x26U, 0x18U, 0x64U, 0x02U, 0x27U, 0x18U, 0x64U, 0x02U, 0xD2U, 0x00U, 0x14U, 0xF4U, 0x0FU,
    0x1CU, 0x36U, 0xD0U, 0x04U, 0x10U, 0x40U, 0xE9U, 0x20U, 0x18U, 0xECU, 0x02U, 0xC2U, 0xB3U, 0x05U, 0x00U, 0x04U,
    0xCFU, 0x05U, 0x00U, 0x04U, 0x1CU, 0x36U, 0xD0U, 0x04U, 0x10U, 0x40U, 0xE9U, 0x20U, 0x18U, 0xECU, 0x02U, 0xC2U,
    0xB3U, 0x05U, 0x00U, 0x04U, 0xCFU, 0x05U, 0x00U, 0x04U, 0x02U, 0xC4U, 0x08U, 0x01U, 0x83U, 0x05U, 0x00U, 0x04U,
    0x18U, 0xECU, 0x02U, 0xC0U, 0x00U, 0x08U, 0x14U, 0x00U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U,
    0x01U, 0x8CU, 0x05U, 0x03U, 0x18U, 0x20U, 0x02U, 0xF2U, 0x83U, 0x05U, 0x00U, 0x04U, 0x18U, 0xCCU, 0x00U, 0x20U,
    0x18U, 0xCCU, 0x00U, 0x21U, 0x0DU, 0x88U, 0xF4U, 0x1FU, 0x01U, 0x90U, 0x05U, 0x02U, 0x0EU, 0x82U, 0xF4U, 0x00U,
    0x20U, 0x04U, 0x04U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0xE4U, 0x01U,
    0x20U, 0x04U, 0x14U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0xD4U, 0x02U, 0x20U, 0x04U, 0x24U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0xC4U, 0x03U, 0x20U, 0x04U, 0x34U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0xB4U, 0x04U, 0x20U, 0x04U, 0x44U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0xA4U, 0x05U, 0x20U, 0x04U, 0x54U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x94U, 0x06U, 0x20U, 0x04U, 0x64U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x84U, 0x07U, 0x20U, 0x04U, 0x74U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x74U, 0x08U,
    0x20U, 0x04U, 0x84U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x64U, 0x09U,
    0x20U, 0x04U, 0x94U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x54U, 0x0AU, 0x20U, 0x04U, 0xA4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x44U, 0x0BU, 0x20U, 0x04U, 0xB4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x34U, 0x0CU, 0x20U, 0x04U, 0xC4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x24U, 0x0DU, 0x20U, 0x04U, 0xD4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x14U, 0x0EU, 0x20U, 0x04U, 0xE4U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U,
    0x0EU, 0x82U, 0x04U, 0x0FU, 0x20U, 0x04U, 0xF4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x38U, 0xECU, 0x02U, 0x21U, 0x38U, 0xECU, 0x02U, 0x22U, 0x06U, 0x88U, 0x14U, 0x00U,
    0x18U, 0x20U, 0x02U, 0xF2U, 0x83U, 0x05U, 0x00U, 0x04U, 0x70U, 0x47U, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U,
    0x04U, 0x18U, 0x04U, 0x33U, 0x10U, 0x18U, 0x68U, 0x02U, 0x10U, 0x18U, 0x60U, 0x02U, 0x01U, 0xB0U, 0x05U, 0x00U,
    0x01U, 0x8CU, 0x05U, 0x03U, 0x01U, 0x68U, 0x07U, 0x01U, 0x01U, 0x6CU, 0x07U, 0x01U, 0x06U, 0x74U, 0x47U, 0x00U,
    0x00U, 0x88U, 0x00U, 0x00U, 0x01U, 0x92U, 0x6CU, 0xDBU, 0x18U, 0x64U, 0x02U, 0x20U, 0x18U, 0x64U, 0x02U, 0x21U,
    0x18U, 0x64U, 0x02U, 0x22U, 0x18U, 0x64U, 0x02U, 0x23U, 0x18U, 0x64U, 0x02U, 0x24U, 0x18U, 0x64U, 0x02U, 0x25U,
    0x18U, 0x64U, 0x02U, 0x26U, 0x18U, 0x64U, 0x02U, 0x27U, 0x18U, 0x64U, 0x02U, 0xD2U, 0x00U, 0x14U, 0xF4U, 0x0FU,
    0x1CU, 0x36U, 0xD0U, 0x04U, 0x10U, 0x40U, 0xE9U, 0x20U, 0x18U, 0xECU, 0x02U, 0xC2U, 0xABU, 0x07U, 0x00U, 0x04U,
    0xCBU, 0x07U, 0x00U, 0x04U, 0x08U, 0xFEU, 0x05U, 0x30U, 0xC2U, 0xC4U, 0x08U, 0x01U, 0x08U, 0x76U, 0x47U, 0x02U,
    0x06U, 0xDCU, 0x15U, 0x00U, 0x18U, 0x20U, 0x02U, 0xF2U, 0x18U, 0xECU, 0x02U, 0xC0U, 0x00U, 0x08U, 0x14U, 0x00U,
    0x00U, 0x1CU, 0x04U, 0x00U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U, 0x01U, 0x8CU, 0x05U, 0x03U,
    0x18U, 0x20U, 0x02U, 0xF2U, 0x83U, 0x07U, 0x00U, 0x04U, 0x00U, 0x1CU, 0x04U, 0x00U, 0x18U, 0xCCU, 0x00U, 0x20U,
    0x18U, 0xCCU, 0x00U, 0x21U, 0x0DU, 0x88U, 0xF4U, 0x1FU, 0x01U, 0x90U, 0x05U, 0x02U, 0x0EU, 0x82U, 0x84U, 0x01U,
    0x20U, 0x04U, 0x04U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x04U, 0x03U,
    0x20U, 0x04U, 0x14U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x84U, 0x04U, 0x20U, 0x04U, 0x24U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x04U, 0x06U, 0x20U, 0x04U, 0x34U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x84U, 0x07U, 0x20U, 0x04U, 0x44U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x04U, 0x09U, 0x20U, 0x04U, 0x54U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x84U, 0x0AU, 0x20U, 0x04U, 0x64U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x04U, 0x0CU, 0x20U, 0x04U, 0x74U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x84U, 0x0DU,
    0x20U, 0x04U, 0x84U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x04U, 0x0FU,
    0x20U, 0x04U, 0x94U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x84U, 0x10U, 0x20U, 0x04U, 0xA4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U,
    0x0EU, 0x82U, 0x04U, 0x12U, 0x20U, 0x04U, 0xB4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x84U, 0x13U, 0x20U, 0x04U, 0xC4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x04U, 0x15U, 0x20U, 0x04U, 0xD4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U,
    0x21U, 0x8CU, 0x05U, 0x03U, 0x25U, 0x44U, 0x00U, 0x33U, 0x0EU, 0x82U, 0x84U, 0x16U, 0x20U, 0x04U, 0xE4U, 0x00U,
    0x22U, 0x00U, 0x15U, 0x00U, 0x25U, 0x44U, 0x00U, 0x33U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x18U, 0xECU, 0x02U, 0xC2U,
    0x0EU, 0x82U, 0x04U, 0x18U, 0x20U, 0x04U, 0xF4U, 0x00U, 0x22U, 0x00U, 0x15U, 0x00U, 0x21U, 0x8CU, 0x05U, 0x03U,
    0x25U, 0x44U, 0x00U, 0x33U, 0x38U, 0xECU, 0x02U, 0x21U, 0x38U, 0xECU, 0x02U, 0x22U, 0x06U, 0x88U, 0x14U, 0x00U,
    0x18U, 0x20U, 0x02U, 0xF2U, 0x83U, 0x07U, 0x00U, 0x04U, 0x70U, 0x47U, 0x00U, 0xBFU, 0x00U, 0xBFU, 0x00U, 0xBFU,
    0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U, 0x12U, 0x00U, 0x00U, 0x00U,
    0x04U, 0x18U, 0x04U, 0x33U, 0x10U, 0x18U, 0x68U, 0x02U, 0x10U, 0x18U, 0x60U, 0x02U, 0x01U, 0xB0U, 0x05U, 0x00U,
    0x01U, 0x8CU, 0x05U, 0x01U, 0x01U, 0x68U, 0x07U, 0x01U, 0x01U, 0x6CU, 0x07U, 0x01U, 0x06U, 0x74U, 0x47U, 0x00U,
    0x00U, 0x88U, 0x00U, 0x00U, 0x01U, 0x92U, 0x6CU, 0xDBU, 0x18U, 0x64U, 0x02U, 0x20U, 0x18U, 0x64U, 0x02U, 0x21U,
    0x18U, 0x64U, 0x02U, 0x22U, 0x18U, 0x64U, 0x02U, 0x23U, 0x18U, 0x64U, 0x02U, 0x24U, 0x18U, 0x64U, 0x02U, 0x25U,
    0x18U, 0x64U, 0x02U, 0x26U, 0x18U, 0x64U, 0x02U, 0x27U, 0x18U, 0x64U, 0x02U, 0xD2U, 0x00U, 0x04U, 0xF4U, 0x0FU,
    0x1CU, 0x36U, 0xD0U, 0x04U, 0x10U, 0x40U, 0xE8U, 0x20U, 0x18U, 0xECU, 0x02U, 0xC2U, 0xABU, 0x09U, 0x00U, 0x04U,
    0xCBU, 0x09U, 0x00U, 0x04U, 0x08U, 0xBEU, 0x04U, 0x28U, 0x82U, 0xC4U, 0x08U, 0x01U, 0x08U, 0x76U, 0x47U, 0x02U,
    0x98U, 0x20U, 0x02U, 0xF2U, 0x06U, 0x88U, 0x14U, 0x00U, 0x18U, 0xECU, 0x02U, 0xC0U, 0x18U, 0xECU, 0x02U, 0xC1U,
    0x01U, 0x8CU, 0x05U, 0x01U, 0x00U, 0x08U, 0x04U, 0x00U, 0x00U, 0x10U, 0x04U, 0x00U, 0x18U, 0x20U, 0x02U, 0xF2U,
    0x05U, 0x44U, 0x00U, 0x33U, 0x83U, 0x09U, 0x00U, 0x04U, 0x18U, 0xECU, 0x02U, 0xC1U, 0x06U, 0x10U, 0x15U, 0x00U,
    0x08U, 0x3EU, 0x05U, 0x05U, 0xB8U, 0xECU, 0x02U, 0xC2U, 0x08U, 0x3EU, 0x05U, 0x23U, 0xB8U, 0xECU, 0x02U, 0x22U,
    0x00U, 0x08U, 0x04U, 0x00U, 0x83U, 0x09U, 0x00U, 0x04U, 0x70U, 0x47U, 0x00U, 0x00U,
};
static const app_camera_init_reg_t s_camera_init_seq[] = {
    {0x12, 0x04}, {0x1e, 0x10}, {0x15, 0x20}, {0x3c, 0x00}, {0x55, 0x2f}, {0x11, 0x81}, {0x73, 0x00}, {0x3e, 0x00},
    {0x6b, 0x40}, {0x70, 0X3A}, {0x71, 0X35}, {0x09, 0x00}, {0xa2, 0x02}, {0xa5, 0x05}, {0xab, 0x07}, {0xaa, 0x94},
    {0x0c, 0x00}, {0x0d, 0x00}, {0x0f, 0x4b}, {0x3b, 0x9F}, {0x3F, 0x04}, {0x4C, 0x00}, {0x92, 0x00}, {0x93, 0x00},
    {0x16, 0x02}, {0x21, 0x02}, {0x22, 0x91}, {0x29, 0x07}, {0x35, 0x0b}, {0x33, 0x0b}, {0x37, 0x1d}, {0x38, 0x71},
    {0x39, 0x2a}, {0x0e, 0x61}, {0x56, 0x40}, {0x57, 0x80}, {0x69, 0x00}, {0x74, 0x19}, {0x40, 0xD0}, {0x3a, 0x0C},
    {0x3d, 0x80}, {0x67, 0x11}, {0x68, 0xFF}, {0x17, 0x15}, {0x18, 0x03}, {0x19, 0x02}, {0x1a, 0x7a}, {0x32, 0x1b},
    {0x03, 0x0a}, {0x72, 0x11}, {0x00, 0x00}, {0x07, 0x3F}, {0x10, 0xFF}, {0x13, 0x66}, {0x14, 0x21}, {0x24, 0x75},
    {0x25, 0x63}, {0x26, 0xA5}, {0x43, 0x14}, {0x44, 0xf0}, {0x45, 0x34}, {0x46, 0x58}, {0x47, 0x28}, {0x48, 0x3a},
    {0x49, 0x9e}, {0x4f, 0xc0}, {0x50, 0xc0}, {0x51, 0x00}, {0x52, 0x33}, {0x53, 0x8d}, {0x54, 0xc0}, {0x59, 0x88},
    {0x5a, 0x88}, {0x5b, 0x44}, {0x5c, 0x67}, {0x5d, 0x49}, {0x5e, 0x0e}, {0x6c, 0x0a}, {0x6d, 0x55}, {0x6e, 0x11},
    {0x6f, 0x9f}, {0x62, 0x00}, {0x63, 0x00}, {0x64, 0x04}, {0x65, 0x20}, {0x66, 0x05}, {0x94, 0x04}, {0x95, 0x08},
    {0x7a, 0x20}, {0x7b, 0x1c}, {0x7c, 0x28}, {0x7d, 0x3c}, {0x7e, 0x55}, {0x7f, 0x68}, {0x80, 0x76}, {0x81, 0x80},
    {0x82, 0x88}, {0x83, 0x8f}, {0x84, 0x96}, {0x85, 0xa3}, {0x86, 0xaf}, {0x87, 0xc4}, {0x88, 0xd7}, {0x89, 0xe8},
    {0x9f, 0x78}, {0xa0, 0x68}, {0x31, 0xff}, {0xa1, 0x03}, {0xa6, 0xdf}, {0xa7, 0xdf}, {0xa8, 0xf0}, {0xa9, 0x90},
    {0xb0, 0x84}, {0xb1, 0x0c}, {0xb2, 0x0e}, {0xb3, 0x82}, {0xb8, 0x0a},
};

static struct rt_i2c_bus_device *s_camera_i2c_bus;
static rt_sem_t s_camera_if_semaphore = RT_NULL;

int app_camera_init(void) {
    /* TODO: Initialize SmartDMA and camera I2C here. */

    s_camera_if_semaphore = rt_sem_create("CIF_SEM", 0UL, RT_IPC_FLAG_PRIO);
    if (s_camera_if_semaphore == RT_NULL) {
        rt_kprintf("Failed to create CIF semaphore.\n");
        return -1;
    }

    s_camera_i2c_bus = (struct rt_i2c_bus_device *)rt_device_find(APP_CAMERA_I2C_BUS);
    if (s_camera_i2c_bus == RT_NULL) {
        rt_kprintf("Failed to find I2C bus.\n");

        return -2;
    }

    rt_memcpy(APP_CAMERA_FW_BASE, s_camera_if_firmware, sizeof(s_camera_if_firmware));

    RESET_PeripheralReset(kSMART_DMA_RST_SHIFT_RSTn);
    CLOCK_EnableClock(kCLOCK_Smartdma);

    INPUTMUX_Init(INPUTMUX0);
    INPUTMUX_AttachSignal(INPUTMUX0, 0, kINPUTMUX_GpioPort0Pin4ToSmartDma);
    INPUTMUX_AttachSignal(INPUTMUX0, 1, kINPUTMUX_GpioPort0Pin11ToSmartDma);
    INPUTMUX_AttachSignal(INPUTMUX0, 2, kINPUTMUX_GpioPort0Pin5ToSmartDma);

    SMARTDMA0->CTRL = SMARTDMA_CTRL_WKEY(0xC0DE) | SMARTDMA_CTRL_SYNCEN(1U);

    NVIC_SetPriority(SMARTDMA_IRQn, 4);
    EnableIRQ(SMARTDMA_IRQn);

    CLOCK_AttachClk(kMAIN_CLK_to_CLKOUT);
    CLOCK_SetClkDiv(kCLOCK_DivClkOut, 25U); /* 6MHz required for camera */

    rt_kprintf("CIF initialized.\n");

    return 0;
}

int app_camera_capture(uint8_t *image_name) {
    int ret = 0;

    /* TODO: Capture one frame of image and store to FS. */

    uint8_t *frame = rt_malloc_align(APP_CAMERA_FRAME_SIZE, 4);
    if (!frame) {
        rt_kprintf("Failed to allocate image buffer.\n");
        return -1;
    }

    uint8_t *stack = rt_malloc_align(APP_CAMERA_STACK_SIZE, 4);
    if (!stack) {
        rt_kprintf("Failed to allocate CIF stack.\n");

        ret = -1;
        goto free_frame_exit;
    }

    app_camera_params_t *camera_params = rt_malloc_align(sizeof(app_camera_params_t), 4);
    if (!camera_params) {
        rt_kprintf("Failed to allocate CIF parameters.\n");

        ret = -2;
        goto free_stack_exit;
    }

    uint32_t api_pc = ((const uint32_t *)s_camera_if_firmware)[APP_CAMERA_320240_FULL];

    SMARTDMA0->ARM2EZH = (uint32_t)camera_params | 2U; /* Reserve lower 2 bits. */
    SMARTDMA0->BOOTADR = api_pc;
    SMARTDMA0->CTRL = SMARTDMA_CTRL_WKEY(0xC0DE) | SMARTDMA_CTRL_START(1U) | SMARTDMA_CTRL_ERRDIS(1U);

    if (rt_sem_take(s_camera_if_semaphore, RT_WAITING_FOREVER) != RT_EOK) {
        rt_kprintf("Failed to acquire CIF semaphore.\n");

        ret = -3;
        goto free_params_exit;
    }

free_params_exit:
    rt_free_align(camera_params);

free_stack_exit:
    rt_free_align(stack);

free_frame_exit:
    rt_free_align(frame);

    return ret;
}

static int app_camera_i2c_write(uint8_t addr, uint8_t data) {
    return 0;
}

static int app_camera_command(int argc, char **argv) {
    rt_kprintf("Camera commands.\n");

    return 0;
}

void SMARTDMA_IRQHandler(void) {
    SMARTDMA0->CTRL = SMARTDMA_CTRL_WKEY(0xC0DE);
    RESET_PeripheralReset(kSMART_DMA_RST_SHIFT_RSTn);
    SMARTDMA0->CTRL = SMARTDMA_CTRL_WKEY(0xC0DE) | SMARTDMA_CTRL_SYNCEN(1U);

    rt_sem_release(s_camera_if_semaphore);
}

MSH_CMD_EXPORT_ALIAS(app_camera_command, camera, Camera operation);
INIT_APP_EXPORT(app_camera_init);